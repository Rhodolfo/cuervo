fecha_min = pmin(',f_vector_fechas,', na.rm = T),
fecha_max = pmax(',f_vector_fechas,', na.rm = T)
)'
)))
# eval(parse(text = paste0(               pmin está buggeado y no elimina NA's
#   'p_tabla <- p_tabla %>%
#   mutate(
# fecha_min = pmin(',f_vector_fechas,', na.rm = T)
# )'
# )))
# p_tabla <- tail(p_tabla)
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha,p_variables_procesos),levels = c(p_variables_fecha,p_variables_procesos)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
#
if(p_colorear == TRUE){
p_tabla <- eval(parse(text = paste0(
'p_tabla %>%
mutate(
color_valor = as.numeric(',p_variables_benchmark,' - p_fecha_actual),
color = cut(
color_valor,
breaks = c(-Inf,',p_parametros$status_morado,',',p_parametros$status_rojo,',',p_parametros$status_amarillo,',Inf),
labels = c("purple","red","yellow","green")
)
) %>%
arrange(color_valor)'
)))
}
}
p_tabla$n <- 1:nrow(p_tabla)
head(p_tabla)
funcion0 <- paste0(
'g <- ggplot(p_tabla)'
)
if(!p_colorear){
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = "darkgrey")'
)
}else{
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = p_tabla$color)'
)
}
funcion2a <- paste0(
'+ geom_point(aes(x = ',p_variables_benchmark,', y = n),color = "red",size = ',f_tamano_bolas * 1.5,', alpha = 1,shape = 108)',collapse = ''
)
funcion3a <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "black",size = ',f_tamano_bolas * 1.3,', alpha = 1,shape = 18)',collapse = ''
)
funcion3b <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "',f_colores[1:length(p_variables_fecha)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion4 <- paste0(
'+ geom_point(data = f_tabla_leyenda, aes(x = x, y = y, color = variables), size = .1)'
)
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[1:length(p_variables_procesos)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
if(nrow(p_tabla)<=40){
funcion4b <- paste0(
'+ geom_text(aes(x = fecha_min-6, y = n, label = pedido),size = ',f_tamano_bolas * 1,')'
)
}else{
funcion4b <- ''
}
funcion5 <- paste0(
'+ scale_color_manual(labels = c("',paste0(p_variables_fecha,collapse = '","'),'"),values = c("',paste0(f_colores,collapse = '","'),'"))'
)
funcion6 <- paste0(
'+ guides(colour = guide_legend(override.aes = list(size=5, alpha = 1)))'
)
funcion7 <- paste0(
'+ scale_x_date(date_labels="%y %b %d",date_breaks  ="5 days")'
)
funcion8 <- paste0(
'+ theme(axis.text.x = element_text(angle = 90, hjust = 1))'
)
if(!p_colorear){
funcion9 = ''
}else{
funcion9 <- paste0(
'+ ggtitle("día de comparación:',p_fecha_actual,'")'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
f_tabla_leyenda
p_tabla <- f_tabla
p_variable_wrap <- p_variable_pedido
p_variables_fecha <- f_variables_fecha
p_variables_benchmark <- f_variables_benchmark
p_colorear <- TRUE
p_fecha_actual <- parametros$fecha_actual
p_variables_procesos <- f_variables_procesos
names(p_tabla)[1] <- 'pedido'
f_tamano_bolas <- 14/(log(nrow(p_tabla)))
f_vector_fechas <- paste0(p_variables_fecha,collapse = ',')
f_colores <- rainbow(length(p_variables_fecha))
eval(parse(text = paste0(
'p_tabla <- p_tabla %>%
mutate(
fecha_min = pmin(',f_vector_fechas,', na.rm = T),
fecha_max = pmax(',f_vector_fechas,', na.rm = T)
)'
)))
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha),levels = c(p_variables_fecha)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
if(p_colorear == TRUE){
f_colores <- rainbow(length(p_variables_fecha) + length(p_variables_procesos))
p_tabla <- eval(parse(text = paste0(
'p_tabla %>%
mutate(
color_valor = as.numeric(',p_variables_benchmark,' - p_fecha_actual),
color = cut(
color_valor,
breaks = c(-Inf,',p_parametros$status_morado,',',p_parametros$status_rojo,',',p_parametros$status_amarillo,',Inf),
labels = c("purple","red","yellow","green")
)
) %>%
arrange(color_valor)'
)))
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha,p_variables_procesos),levels = c(p_variables_fecha,p_variables_procesos)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
}
head(p_tabla)
f_tabla_leyenda
funcion0 <- paste0(
'g <- ggplot(p_tabla)'
)
if(!p_colorear){
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = "darkgrey")'
)
}else{
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = p_tabla$color)'
)
}
funcion2a <- paste0(
'+ geom_point(aes(x = ',p_variables_benchmark,', y = n),color = "red",size = ',f_tamano_bolas * 1.5,', alpha = 1,shape = 108)',collapse = ''
)
funcion3a <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "black",size = ',f_tamano_bolas * 1.3,', alpha = 1,shape = 18)',collapse = ''
)
funcion3b <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "',f_colores[1:length(p_variables_fecha)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion4 <- paste0(
'+ geom_point(data = f_tabla_leyenda, aes(x = x, y = y, color = variables), size = .1)'
)
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[1:length(p_variables_procesos)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
if(nrow(p_tabla)<=40){
funcion4b <- paste0(
'+ geom_text(aes(x = fecha_min-6, y = n, label = pedido),size = ',f_tamano_bolas * 1,')'
)
}else{
funcion4b <- ''
}
funcion5 <- paste0(
'+ scale_color_manual(labels = c("',paste0(f_tabla_leyenda$variables,collapse = '","'),'"),values = c("',paste0(f_colores,collapse = '","'),'"))'
)
funcion6 <- paste0(
'+ guides(colour = guide_legend(override.aes = list(size=5, alpha = 1)))'
)
funcion7 <- paste0(
'+ scale_x_date(date_labels="%y %b %d",date_breaks  ="5 days")'
)
funcion8 <- paste0(
'+ theme(axis.text.x = element_text(angle = 90, hjust = 1))'
)
if(!p_colorear){
funcion9 = ''
}else{
funcion9 <- paste0(
'+ ggtitle("día de comparación:',p_fecha_actual,'")'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
funcion10
funcion0 <- paste0(
'g <- ggplot(p_tabla)'
)
if(!p_colorear){
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = "darkgrey")'
)
}else{
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = p_tabla$color)'
)
}
funcion2a <- paste0(
'+ geom_point(aes(x = ',p_variables_benchmark,', y = n),color = "red",size = ',f_tamano_bolas * 1.5,', alpha = 1,shape = 108)',collapse = ''
)
funcion3a <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "black",size = ',f_tamano_bolas * 1.3,', alpha = 1,shape = 18)',collapse = ''
)
funcion3b <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "',f_colores[1:length(p_variables_fecha)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion4 <- paste0(
'+ geom_point(data = f_tabla_leyenda, aes(x = x, y = y, color = variables), size = .1)'
)
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
if(nrow(p_tabla)<=40){
funcion4b <- paste0(
'+ geom_text(aes(x = fecha_min-6, y = n, label = pedido),size = ',f_tamano_bolas * 1,')'
)
}else{
funcion4b <- ''
}
funcion5 <- paste0(
'+ scale_color_manual(labels = c("',paste0(f_tabla_leyenda$variables,collapse = '","'),'"),values = c("',paste0(f_colores,collapse = '","'),'"))'
)
funcion6 <- paste0(
'+ guides(colour = guide_legend(override.aes = list(size=5, alpha = 1)))'
)
funcion7 <- paste0(
'+ scale_x_date(date_labels="%y %b %d",date_breaks  ="5 days")'
)
funcion8 <- paste0(
'+ theme(axis.text.x = element_text(angle = 90, hjust = 1))'
)
if(!p_colorear){
funcion9 = ''
}else{
funcion9 <- paste0(
'+ ggtitle("día de comparación:',p_fecha_actual,'")'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
f_tamano_bolas
parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9))
head(p_tabla)
p_tabla <- f_tabla
p_variable_wrap <- p_variable_pedido
p_variables_fecha <- f_variables_fecha
p_variables_benchmark <- f_variables_benchmark
p_colorear <- TRUE
p_fecha_actual <- parametros$fecha_actual
p_variables_procesos <- f_variables_procesos
names(p_tabla)[1] <- 'pedido'
f_tamano_bolas <- 14/(log(nrow(p_tabla)))
f_vector_fechas <- paste0(p_variables_fecha,collapse = ',')
f_colores <- rainbow(length(p_variables_fecha))
eval(parse(text = paste0(
'p_tabla <- p_tabla %>%
mutate(
fecha_min = pmin(',f_vector_fechas,', na.rm = T),
fecha_max = pmax(',f_vector_fechas,', na.rm = T)
)'
)))
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha),levels = c(p_variables_fecha)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
if(p_colorear == TRUE){
f_colores <- rainbow(length(p_variables_fecha) + length(p_variables_procesos))
p_tabla <- eval(parse(text = paste0(
'p_tabla %>%
mutate(
color_valor = as.numeric(',p_variables_benchmark,' - p_fecha_actual),
color = cut(
color_valor,
breaks = c(-Inf,',p_parametros$status_morado,',',p_parametros$status_rojo,',',p_parametros$status_amarillo,',Inf),
labels = c("purple","red","yellow","green")
)
) %>%
arrange(color_valor)'
)))
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha,p_variables_procesos),levels = c(p_variables_fecha,p_variables_procesos)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
}
funcion_grafica_pedidos_puntos <- function(p_tabla, p_variables_fecha,p_variables_benchmark, p_procesos = NULL, p_colorear, p_fecha_actual,p_parametros, p_procesos_incluir = FALSE, p_procesos_tabla = NULL, p_variables_procesos = NULL){
names(p_tabla)[1] <- 'pedido'
f_tamano_bolas <- 14/(log(nrow(p_tabla)))
f_vector_fechas <- paste0(p_variables_fecha,collapse = ',')
f_colores <- rainbow(length(p_variables_fecha))
eval(parse(text = paste0(
'p_tabla <- p_tabla %>%
mutate(
fecha_min = pmin(',f_vector_fechas,', na.rm = T),
fecha_max = pmax(',f_vector_fechas,', na.rm = T)
)'
)))
# eval(parse(text = paste0(               pmin está buggeado y no elimina NA's
#   'p_tabla <- p_tabla %>%
#   mutate(
# fecha_min = pmin(',f_vector_fechas,', na.rm = T)
# )'
# )))
# p_tabla <- tail(p_tabla)
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha),levels = c(p_variables_fecha)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
#
if(p_colorear == TRUE){
f_colores <- rainbow(length(p_variables_fecha) + length(p_variables_procesos))
p_tabla <- eval(parse(text = paste0(
'p_tabla %>%
mutate(
color_valor = as.numeric(',p_variables_benchmark,' - p_fecha_actual),
color = cut(
color_valor,
breaks = c(-Inf,',p_parametros$status_morado,',',p_parametros$status_rojo,',',p_parametros$status_amarillo,',Inf),
labels = c("purple","red","yellow","green")
)
) %>%
arrange(color_valor)'
)))
f_tabla_leyenda <- data.frame(
variables = factor(c(p_variables_fecha,p_variables_procesos),levels = c(p_variables_fecha,p_variables_procesos)),
colores = f_colores,
x = max(p_tabla$fecha_max, na.rm = T),
y = 1
)
}
}
p_tabla$n <- 1:nrow(p_tabla)
head(p_tabla)
funcion0 <- paste0(
'g <- ggplot(p_tabla)'
)
if(!p_colorear){
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = "darkgrey")'
)
}else{
funcion1 <- paste0(
'+ geom_segment(aes(x = fecha_min, xend = fecha_max, y = n, yend = n),color = p_tabla$color)'
)
}
funcion2a <- paste0(
'+ geom_point(aes(x = ',p_variables_benchmark,', y = n),color = "red",size = ',f_tamano_bolas * 1.5,', alpha = 1,shape = 108)',collapse = ''
)
funcion3a <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "black",size = ',f_tamano_bolas * 1.3,', alpha = 1,shape = 18)',collapse = ''
)
funcion3b <- paste0(
'+ geom_point(aes(x = ',p_variables_fecha,', y = n),color = "',f_colores[1:length(p_variables_fecha)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion4 <- paste0(
'+ geom_point(data = f_tabla_leyenda, aes(x = x, y = y, color = variables), size = .1)'
)
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
if(nrow(p_tabla)<=40){
funcion4b <- paste0(
'+ geom_text(aes(x = fecha_min-6, y = n, label = pedido),size = ',f_tamano_bolas * 1,')'
)
}else{
funcion4b <- ''
}
funcion5 <- paste0(
'+ scale_color_manual(labels = c("',paste0(f_tabla_leyenda$variables,collapse = '","'),'"),values = c("',paste0(f_colores,collapse = '","'),'"))'
)
funcion6 <- paste0(
'+ guides(colour = guide_legend(override.aes = list(size=5, alpha = 1)))'
)
funcion7 <- paste0(
'+ scale_x_date(date_labels="%y %b %d",date_breaks  ="5 days")'
)
funcion8 <- paste0(
'+ theme(axis.text.x = element_text(angle = 90, hjust = 1))'
)
if(!p_colorear){
funcion9 = ''
}else{
funcion9 <- paste0(
'+ ggtitle("día de comparación:',p_fecha_actual,'")'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
funcion10 <- ''
funcion11 <- ''
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',1:length(p_variables_procesos),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
if(nrow(p_tabla)<=40){
funcion4b <- paste0(
'+ geom_text(aes(x = fecha_min-6, y = n, label = pedido),size = ',f_tamano_bolas * 1,')'
)
}else{
funcion4b <- ''
}
funcion5 <- paste0(
'+ scale_color_manual(labels = c("',paste0(f_tabla_leyenda$variables,collapse = '","'),'"),values = c("',paste0(f_colores,collapse = '","'),'"))'
)
funcion6 <- paste0(
'+ guides(colour = guide_legend(override.aes = list(size=5, alpha = 1)))'
)
funcion7 <- paste0(
'+ scale_x_date(date_labels="%y %b %d",date_breaks  ="5 days")'
)
funcion8 <- paste0(
'+ theme(axis.text.x = element_text(angle = 90, hjust = 1))'
)
if(!p_colorear){
funcion9 = ''
}else{
funcion9 <- paste0(
'+ ggtitle("día de comparación:',p_fecha_actual,'")'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion10,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion10,funcion11,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',(1:length(p_variables_procesos)+6),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',(1:length(p_variables_procesos)+6),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion10,funcion11,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',(1:length(p_variables_procesos)+14),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',(1:length(p_variables_procesos)+14),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion10,funcion11,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
if(p_procesos_incluir == TRUE){
funcion10 <- paste0(
'+ geom_point(aes(x = fecha_min- ',(1:length(p_variables_procesos)+11),', y = n),color = "',f_colores[(length(p_variables_fecha)+1):length(f_colores)],'",size = ',f_tamano_bolas,', alpha = 1,shape = 18)',collapse = ''
)
funcion11 <- paste0(
'+ geom_text(aes(x = fecha_min- ',(1:length(p_variables_procesos)+11),', y = n, label = ',p_variables_procesos,'),size = ',f_tamano_bolas * .7,')'
)
}
eval(parse(text = paste0(funcion0, funcion1, funcion2a, funcion3a, funcion3b, funcion4,funcion10,funcion11,funcion4b, funcion5, funcion6, funcion7, funcion8, funcion9)))
g
