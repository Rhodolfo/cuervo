funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1,',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2,'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1,',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2,'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = date_format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
str(f_lista_tablas)
library(scales)
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = date_format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
p_texto_x <- 'a'
p_texto_y <- 'a'
p_tabla <- f_lista_tablas[[1]]
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = ', f_tabla[1,i],',',
'xmax = ',f_tabla[1,(i+1)],',',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
funcion_grafica_tiempos_fecha <- function(p_tabla, p_texto_x, p_texto_y){
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = as.Date(', f_tabla[1,i],'),',
'xmax = as.Date(',f_tabla[1,(i+1)],'),',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
}
funcion_grafica_tiempos_fecha(f_lista_tablas[[1]],'a','b')
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = as.Date(', f_tabla[1,i],'),',
'xmax = as.Date(',f_tabla[1,(i+1)],'),',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),',y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(',as.Date(max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1),'),y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2),'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1,'),y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2,'), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1,'),y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2,')), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
head(f_tabla)
str(f_tabla)
f_items_previos <- 3
colores <- rainbow(length(p_tabla) - (f_items_previos + 1))
funcion0 <- paste0(
' ggplot(p_tabla) + '
)
funcion1_lista <- list()
k <- 1
for(j in 1:nrow(p_tabla)){
f_tabla <- p_tabla[j,]                 # ordeno cronológicamente las variables
f_tabla <- f_tabla[,!is.na(f_tabla)]
f_orden <- order(unlist(f_tabla[-c(1:f_items_previos)])) + f_items_previos
f_tabla <- f_tabla[,c(1:f_items_previos,f_orden)]
f_colores <- colores[match(names(f_tabla)[(f_items_previos + 2):length(f_tabla)],names(p_tabla)[(f_items_previos + 1):length(p_tabla)]) - 1]
for(i in (f_items_previos + 1):(length(f_tabla) - 1)){     # creo el código para la serie
funcion1_lista[[k]] <- paste0(
'geom_rect(data = f_tabla,aes(xmin = as.Date("', f_tabla[1,i],'"),',
'xmax = as.Date("',f_tabla[1,(i+1)],'"),',
'ymin = ',j-.3,',',
'ymax = ',j+.3,'),fill = "',f_colores[i - f_items_previos],'", color = "black", alpha = 1)'
)
k <- k+1
}
}
funcion2_tabla <- data.frame(
y = (1:length(colores)) + nrow(p_tabla),
x = 1,
nombre = names(p_tabla[c((f_items_previos + 2):length(p_tabla))]),
color = colores
)
funcion1 <- paste0(unlist(funcion1_lista),collapse = '+')
funcion2 <- paste0(
'+ geom_point(data = funcion2_tabla,aes(x=as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 1,'),y=1,fill = color,colour = color)) +
geom_text(data = p_tabla, aes(x = rep(as.Date(',max(p_tabla$fecha_original_preferente_max,na.rm=T) + 2,')), y = 1:nrow(p_tabla), label = pedido)) +
scale_color_manual(name = "proceso",labels= c(as.character(funcion2_tabla$nombre)), values = colores) +
guides(fill = FALSE,colour = guide_legend(override.aes = list(size=10))) +
xlab("',p_texto_x,'") + ylab("',p_texto_y,'")+
theme(legend.position="bottom",
legend.title = element_text(size=16),
legend.text = element_text(size=16))+
scale_x_date(labels = format("%Y-%m-%d"))'
)
funcion_completa <- paste0(
funcion0,
funcion1,
funcion2
)
funcion_completa
parse(text = funcion_completa)
eval(parse(text = funcion_completa))
